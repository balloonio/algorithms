class Solution:
    def minMalwareSpread(self, graph, initial):
        """
        :type graph: List[List[int]]
        :type initial: List[int]
        :rtype: int
        """
        """
        一开始分情况思考怎么拆图 发现不太对 情况有点多 陷入江局
        于是定下心来思考 总觉得这个跟染色啥的很像 然后灵光闪现
        发现这个不就是每个mal node 分别染色 各染各的么
        每个good node可以被多个mal node同时染上他们的颜色
        哪个mal node独家染坏的good node最多 那就是这台mal node最屌
        这里有一点注意因为有可能mal node 连着一个good node和一个mal node
        如果他拆掉了, 另一个mal node也染不到这个good node了
        所以对于每个mal node,其他的mal node就像墙一样 不可以跨过去继续染
        e.g. BAD1 === BAD2 === GOOD3
        这种情况下GOOD3只可以被染上BAD2,不可以被染上BAD1,因为GOOD3要算作BAD2的独家染坏
        """

        if not graph or not initial:
            return -1

        color = collections.defaultdict(set)

        mal2visited = collections.defaultdict(set)
        q = collections.deque()
        for mal in initial:
            q.append((mal, mal))  # current node, infecting by mal node
            mal2visited[mal].add(mal)

        while q:
            node, malsource = q.popleft()
            # this node is another different mal node, we cant color across it
            if node in initial and node != malsource:
                continue
            # color current node by the malsource color
            color[node].add(malsource)
            # keep going, infect its neigbors!
            for next_node, connected in enumerate(graph[node]):
                if connected == 0:
                    continue
                if next_node in mal2visited[malsource]:
                    continue
                q.append((next_node, malsource))
                mal2visited[malsource].add(next_node)

        mal2exclusive = collections.defaultdict(int)
        for node, malcolors in color.items():
            if len(malcolors) == 1:
                mc = malcolors.pop()
                mal2exclusive[mc] += 1

        maxmal = None
        maxinfect = None
        for mal, infect in mal2exclusive.items():
            if maxmal is None:
                maxmal = mal
                maxinfect = infect
            elif infect > maxinfect:
                maxmal = mal
                maxinfect = infect
            elif infect == maxinfect and mal < maxmal:
                maxmal = mal
                maxinfect = infect
        return maxmal


"""
第一次周赛有名次~ 虽然最后一题比截止时间晚了一点点 但是是自己想出来的 而且没花太大力气
况且malware 1 上周的周赛都没做 所以读题多花了一些时间
Rank	Name	Score	Finish Time 	Q1 (4)	Q2 (5)	Q3 (8)	Q4 (8)
397 / 3711	zhang835 	17	1:25:00	 0:21:43  1	 0:44:42	 1:20:00
"""
